service: serverless-app

custom:
  bucket: S3Bucket
  streamname: testStream 

provider:
  name: aws
  runtime: nodejs12.x
  stage: ${opt:stage, 'dev'} # Set the default stage used. Default is dev
  region: ${opt:region, 'us-east-1'} # Overwrite the default region used. Default is us-east-1
  stackName: vedant-serverless-app # Use a custom name for the CloudFormation stack
  apiName: serverless-app # Use a custom name for the API Gateway API
  deploymentPrefix: serverless
  memorySize: 256
  # apiGateway: # Optional API Gateway global config
  #   restApiId: xxxxxxxxxx # REST API resource ID. Default is generated by the framework
  #   restApiRootResourceId: xxxxxxxxxx # Root resource ID, represent as / path
  #   restApiResources: # List of existing resources that were created in the REST API. This is required or the stack will be conflicted
  #     '/events': xxxxxxxxxx
  #     '/users/create': xxxxxxxxxx
  #   websocketApiId: # Websocket API resource ID. Default is generated by the framework
  #   apiKeySourceType: HEADER # Source of API key for usage plan. HEADER or AUTHORIZER.
  #   minimumCompressionSize: 1024 # Compress response when larger than specified size in bytes (must be between 0 and 10485760)
  #   description: Some Description # Optional description for the API Gateway stage deployment
  #   binaryMediaTypes: # Optional binary media types the API might return
  #     - '*/*'
  iamRoleStatements:
    - Effect: Allow
      Action:
        - s3:PutObject
        - s3:PutObjectAcl
      Resource: "arn:aws:s3:::${self:custom.bucket}/*"

functions:
  save:
    handler: handler.save
    environment:
      BUCKET: ${self:custom.bucket}
  streamer:
    handler: handler.import
    events:
      - stream:
          type: kinesis
          arn: arn:aws:kinesis:us-east-1:928097140335:stream/${self:custom.streamname}
          batchSize: 100
          startingPosition: TRIM_HORIZON
          enabled: true
  
# Resources to be created - Raw CloudFormation
# TODO: Separate out of this yaml
resources:
  Resources:
    # S3BucketOutputs:
    #   Type: AWS::S3::Bucket
    #   Properties:
    #     BucketName: ${self:custom.bucket}
    Stream:
      Type: AWS::Kinesis::Stream
      Properties:
        Name: ${self:custom.streamname}
        ShardCount: 1
